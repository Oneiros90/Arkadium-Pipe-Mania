import{A as f,C as S,G as w,a as E,b,f as v,c as m,d as D,D as t,S as p,e as r,g as h,P as y}from"./GridRenderer-BJLz8noh.js";class N{constructor(e){this.rootElement=e,this.app=new f,this.container=new S,this.grid=new w(0,0),this.tooltip=this.createTooltip()}app;container;grid;renderer;cellSize=128;testConfigs=[];animationPhase=0;tooltip;cols=6;flowSpeed=.3;visualConfig;assetManager;async initialize(){this.visualConfig=await E.loadVisualConfig("/config/visual.yaml"),this.assetManager=new b,await this.assetManager.loadAssets(v(this.visualConfig.assets)),this.setupTestConfigs();const e=Math.ceil(this.testConfigs.length/this.cols);this.grid=new w(this.cols,e);const i=this.cols*this.cellSize+40,o=e*this.cellSize+40;await this.app.init({width:i,height:o,backgroundColor:1710618,antialias:!0}),this.rootElement.appendChild(this.app.canvas),this.container.x=20,this.container.y=20,this.app.stage.addChild(this.container);const s=new m;s.rect(0,0,this.cols*this.cellSize,e*this.cellSize),s.fill(2763306),this.container.addChild(s),this.renderer=new D(this.container,this.grid,this.visualConfig,this.assetManager),this.populateTestGrid(this.cols),this.renderer.initialize(),this.setupMouseEvents(),this.app.ticker.add(n=>this.animate(n.deltaMS/1e3))}createTooltip(){const e=document.createElement("div");return e.className="tooltip",e.style.display="none",document.body.appendChild(e),e}setupMouseEvents(){const e=this.app.canvas;e.addEventListener("mousemove",i=>{const o=e.getBoundingClientRect(),s=i.clientX-o.left-this.container.x,n=i.clientY-o.top-this.container.y,a=Math.floor(s/this.cellSize),l=Math.floor(n/this.cellSize);if(a>=0&&a<this.cols&&l>=0&&l<Math.ceil(this.testConfigs.length/this.cols)){const c=l*this.cols+a;if(c<this.testConfigs.length){const d=this.testConfigs[c];this.tooltip.textContent=`${d.label} | Row: ${l}, Col: ${a}`,this.tooltip.style.display="block",this.tooltip.style.left=`${i.clientX+15}px`,this.tooltip.style.top=`${i.clientY+15}px`}else this.tooltip.style.display="none"}else this.tooltip.style.display="none"}),e.addEventListener("mouseleave",()=>{this.tooltip.style.display="none"})}setupTestConfigs(){this.testConfigs=[{pipe:new p(0),waterDirections:[t.North],label:"Straight V (N->S)"},{pipe:new p(0),waterDirections:[t.South],label:"Straight V (S->N)"},{pipe:new p(90),waterDirections:[t.East],label:"Straight H (E->W)"},{pipe:new p(90),waterDirections:[t.West],label:"Straight H (W->E)"},{pipe:new r(0),waterDirections:[t.North],label:"Curved NE (N->E)"},{pipe:new r(0),waterDirections:[t.East],label:"Curved NE (E->N)"},{pipe:new r(90),waterDirections:[t.East],label:"Curved ES (E->S)"},{pipe:new r(90),waterDirections:[t.South],label:"Curved ES (S->E)"},{pipe:new r(180),waterDirections:[t.South],label:"Curved SW (S->W)"},{pipe:new r(180),waterDirections:[t.West],label:"Curved SW (W->S)"},{pipe:new r(270),waterDirections:[t.West],label:"Curved WN (W->N)"},{pipe:new r(270),waterDirections:[t.North],label:"Curved WN (N->W)"},{pipe:new h,waterDirections:[t.North],label:"Cross 1st pass (N->S)"},{pipe:new h,waterDirections:[t.South],label:"Cross 1st pass (S->N)"},{pipe:new h,waterDirections:[t.East],label:"Cross 1st pass (E->W)"},{pipe:new h,waterDirections:[t.West],label:"Cross 1st pass (W->E)"},{pipe:new h,waterDirections:[t.North,t.East],label:"Cross both (N then E)"},{pipe:new h,waterDirections:[t.South,t.West],label:"Cross both (S then W)"}]}populateTestGrid(e){this.testConfigs.forEach((i,o)=>{const s=Math.floor(o/e),n=o%e,a={row:s,col:n},l=new y(a,i.pipe);this.grid.cells[s][n]=l})}animate(e){this.animationPhase+=e*this.flowSpeed,this.testConfigs.forEach((i,o)=>{const s=Math.floor(o/this.cols),n=o%this.cols,a=this.grid.getCell({row:s,col:n});if(a&&a.pipe){const l=this.animationPhase%i.waterDirections.length;i.waterDirections.forEach((c,d)=>{const u=Math.max(0,Math.min(1,l-d));a.setWaterLevel(u,c)}),this.renderer.updateCell(s,n)}})}}const g=document.getElementById("game-container");g&&new N(g).initialize();
